<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habímate | Editar Usuario</title>
    <link rel="stylesheet" href="CSS/editarUsuarioDesign.css">
    <link rel="stylesheet" href="CSS/bootstrap.min.css">
</head>
<body>
    <!--Navegador-->
    <nav id="idNav" class="navbar navbar-expand-lg">
        <button id="btnLogo" class="navbar-brand" type="button">
            <img src="Images/HabimateLogo.png" width="160px"/>
        </button>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#idNavLinks" aria-controls="idNavLinks" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div id="idNavLinks" class="collapse navbar-collapse">
            <div>
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="dashboard.html">Inicio</a>
                    </li>
                </ul>
            </div>
            <div>
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="estudiante.html">Perfíl</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="login.html">Chat</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="login.html">Cerrar Sesión</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Cuerpo -->
    <div id="idRegister" class="form-box form-value container">
        <h1 class="text">Editar Usuario</h1>
        <form method="POST" action="editar.php" enctype="multipart/form-data">
            <div class="row">
                <div class="col-6 col-md-4">
                    <div class="row">
                        <a class="volver" href="#">
                            <button id="btnVolver">Volver al perfíl del usuario</button>
                        </a>
                    </div>

                    <div class="avatar">
                        <img id="idAvatarSample" src="Images/avatarSample.png" 
                        class="rounded-circle" alt="Avatar">

                        <input class="form-control" type="file" id="btnAvatar" name="btnAvatar" onchange="mostrarAvatar(event, 'idAvatarSample')" accept="image/*">
                    </div>
                </div>
                <div class="col-12 col-md-8">
                    <div class="row">
                        <h2 class="text">Información Personal</h2>
                    </div>

                    <div class="row">
                        <div class="col">
                            <div id="idInputs" class="inputbox">
                                <label for="ffullname">Nombre completo</label>
                                <input id="txtFullname" name="txtFullname" type="text">
                            </div>
                            <div id="idInputs" class="inputbox">
                                <label for="fusername">Nombre de Usuario</label>
                                <input id="txtUsername" name="txtUsername" type="text">
                                <small class="form-text">
                                    Debe contener un mínimo de 3 carácteres.
                                </small>
                            </div>
                            <div id="idInputs" class="inputbox">
                                <label for="femail">Correo electrónico</label>
                                <input id="txtEmail" name="txtEmail" type="email">
                            </div>
                            <div id="idInputs" class="inputbox">
                                <label for="fpassword">Contraseña</label>
                                <input id="txtPassword" name="txtPassword" type="password">
                                <small class="form-text">
                                    Debe contener un mínimo de 8 carácteres, una mayúscula,
                                    &nbsp;&nbsp;una minúscula, un número y un carácter especial.
                                </small>
                            </div>
                        </div>

                        <div class="col">
                            <div id="idInputs" class="inputbox item item-2">
                                <label for="fdate">Fecha de Nacimiento: </label> 
                                <input class="inputRegistrar" type="date" id="txtBirthdate" name="ffechanacimiento"/>
                            </div>
                            
                            <label class="subtitle">Género</label>
                            <div id="idRB" name="idRB">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" id="RBH" name="inlineRadioOptions" id="inlineRadio1" value="option1">
                                    <label class="form-check-label" for="inlineRadio1">Hombre</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" id="RBM" name="inlineRadioOptions" id="inlineRadio2" value="option2">
                                    <label class="form-check-label" for="inlineRadio1">Mujer</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" id="RBNB" name="inlineRadioOptions" id="inlineRadio3" value="option3">
                                    <label class="form-check-label" for="inlineRadio1">No binario</label>
                                </div>
                            </div>

                            <label class="subtitle">Rol del usuario</label>
                            <select id="idRol" name="idRol" class="form-select" aria-label="Default select example">
                                <option class="item item-1" value="" selected>Selecciona un rol</option>
                                <option class="item" id="dropdown" value="1">Estudiante</option>
                                <option class="item" id="dropdown"  value="2">Instructor</option>
                                <option class="item" id="dropdown"  value="3">Administrador</option>
                            </select>
                            
                            <button id="btnRegister" type="submit">Guardar cambios</button>
                        </div>
                    </div>
                </div>
                
            </div>
        </form>
    </div>

    <!-- Footer -->
    <footer>
        <iframe class="footer" src="Footer.html" frameborder="0" scrolling="no"></iframe>
    </footer>

    <!--Archivos externos-->
    <script>
        function MosPerfil() {
            fetch('editarM.php')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert(data.error);
                        window.location.href = 'login.html';
                        return;
                    }

                    document.getElementById('txtUsername').value = data.nombre_usuario;
                    document.getElementById('txtFullname').value = data.nombre_completo;
                    document.getElementById('txtPassword').value = data.comtrasena;
                    document.getElementById('txtEmail').value = data.correo;
                    document.getElementById('txtBirthdate').value = data.fecha_nac;
                    if(data.rol == "estudiante")document.getElementById('idRol').value = 1;
                    else if(data.rol == "instructor") document.getElementById('idRol').value =2;
                    else document.getElementById('idRol').value =3;
                    
                    if (data.genero == "hombre") document.getElementById('RBH').checked = true;
                    else if (data.genero == "mujer") document.getElementById('RBM').checked = true;
                    else document.getElementById('RBNB').checked = true;

                    const avatarImg = document.getElementById('idAvatarSample');
                    if (data.foto) {
                        avatarImg.src = `data:${data.mime};base64,${data.foto}`;
                    } else {
                        avatarImg.src = 'Images/avatarSampleAmarillo.png';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
        window.onload = MosPerfil;
    </script>
    <script src="JS/jquery-3.7.1.min.js"></script>
    <script src="JS/bootstrap.min.js"></script>
    <script src="JS/registroScript.js"></script>
</body>
</html>